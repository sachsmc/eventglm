<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Examples of using eventglm and interpreting the results • eventglm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Examples of using eventglm and interpreting the results">
<meta property="og:description" content="eventglm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eventglm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example-analysis.html">Examples of using eventglm and interpreting the results</a>
    </li>
    <li>
      <a href="../articles/extenstions.html">Extending eventglm</a>
    </li>
    <li>
      <a href="../articles/stata-sas-comparason.html">Comparison to other software</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sachsmc/eventglm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Examples of using eventglm and interpreting the
results</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sachsmc/eventglm/blob/HEAD/vignettes/example-analysis.Rmd" class="external-link"><code>vignettes/example-analysis.Rmd</code></a></small>
      <div class="hidden name"><code>example-analysis.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sachsmc.github.io/eventglm/" class="external-link">eventglm</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'eventglm'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:survival':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     colon, mgus2</span></span></code></pre></div>
<div class="section level2">
<h2 id="colon-cancer-treatment-and-time-to-death-standard-survival">Colon cancer treatment and time to death (standard survival)<a class="anchor" aria-label="anchor" href="#colon-cancer-treatment-and-time-to-death-standard-survival"></a>
</h2>
<p>Our first example concerns the <code>colon</code> dataset, which is
included in the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">eventglm</span><span class="fu">::</span><span class="va"><a href="../reference/colon.html">colon</a></span></span></code></pre></div>
<p>This is a randomized trial, so the main interest is in comparing the
distributions of time to death between the three treatment arms. Let’s
start with a survival curve.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span>, data <span class="op">=</span> <span class="va">colon</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sfit</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"slateblue"</span>, <span class="st">"salmon"</span><span class="op">)</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"days since registration"</span>, ylab <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"slateblue"</span>, <span class="st">"salmon"</span><span class="op">)</span>, </span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sfit</span><span class="op">$</span><span class="va">strata</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>As we know, hazard ratios are difficult to interpret as causal
effects, even in randomized controlled trials. Better options for
summarizing the effect of treatment are the survival at a particular
time, or the restricted mean survival up to a given time. Let’s compare
the survival at 7 years, or about 2500 days since registration.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sfit</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, conf.int <span class="op">=</span> <span class="cn">FALSE</span>, xlab <span class="op">=</span> <span class="st">"days since registration"</span>, ylab <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seg0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sfit</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, times <span class="op">=</span> <span class="va">sfit</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">sfit</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;=</span> <span class="fl">2500</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rect.html" class="external-link">rect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">seg0</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">seg0</span><span class="op">$</span><span class="va">time</span>, <span class="fl">2500</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">seg0</span><span class="op">$</span><span class="va">surv</span><span class="op">)</span>, </span>
<span>     border <span class="op">=</span> <span class="cn">NA</span>, col <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">sfit</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, conf.int <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">2500</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2500</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sfit</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, times <span class="op">=</span> <span class="fl">2500</span><span class="op">)</span><span class="op">$</span><span class="va">surv</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>In the figure above, we plot only the survival curve in the
observation group. The vertical dotted line is at the time of interest
(tmax = 2500 days). The open point is at the estimated survival
probability at time tmax, i.e., <span class="math inline">\(P(T &gt;
tmax)\)</span> and the shaded area represents the restricted mean
survival up to tmax, i.e., <span class="math inline">\(E\{\min(T,
tmax)\} = \int_0^{tmax} P(T &gt; u) \, du\)</span>. We can estimate
these things using the <code>survival</code> package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colon.sfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sfit</span>, times <span class="op">=</span> <span class="fl">2500</span>, rmean <span class="op">=</span> <span class="fl">2500</span><span class="op">)</span></span>
<span><span class="va">colon.sfit</span></span>
<span><span class="co">#&gt; Call: survfit(formula = Surv(time, status) ~ rx, data = colon)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 rx=Obs </span></span>
<span><span class="co">#&gt;         time       n.risk      n.event     survival      std.err lower 95% CI </span></span>
<span><span class="co">#&gt;     2.50e+03     5.00e+01     1.65e+02     4.55e-01     2.98e-02     4.00e-01 </span></span>
<span><span class="co">#&gt; upper 95% CI </span></span>
<span><span class="co">#&gt;     5.18e-01 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 rx=Lev </span></span>
<span><span class="co">#&gt;         time       n.risk      n.event     survival      std.err lower 95% CI </span></span>
<span><span class="co">#&gt;     2.50e+03     5.80e+01     1.57e+02     4.85e-01     2.92e-02     4.31e-01 </span></span>
<span><span class="co">#&gt; upper 95% CI </span></span>
<span><span class="co">#&gt;     5.46e-01 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 rx=Lev+5FU </span></span>
<span><span class="co">#&gt;         time       n.risk      n.event     survival      std.err lower 95% CI </span></span>
<span><span class="co">#&gt;     2.50e+03     6.50e+01     1.21e+02     5.88e-01     2.96e-02     5.33e-01 </span></span>
<span><span class="co">#&gt; upper 95% CI </span></span>
<span><span class="co">#&gt;     6.49e-01</span></span></code></pre></div>
<p>And we can now do inference using the <code>eventglm</code> package.
First, we fit a regression model for the cumulative incidence, or 1 -
survival:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colon.cifit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span>, time <span class="op">=</span> <span class="fl">2500</span>, data <span class="op">=</span> <span class="va">colon</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">colon.cifit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; cumincglm(formula = Surv(time, status) ~ rx, time = 2500, data = colon)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -0.5875  -0.4902  -0.3467   0.4863   2.1103  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)  0.54345    0.02946  18.449  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; rxLev       -0.02907    0.04173  -0.697  0.48596    </span></span>
<span><span class="co">#&gt; rxLev+5FU   -0.13176    0.04186  -3.148  0.00165 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 253.10  on 928  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 250.15  on 926  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span>
<span><span class="va">se.ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">colon.cifit</span>, type <span class="op">=</span> <span class="st">"robust"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b.ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">colon.cifit</span><span class="op">)</span></span>
<span><span class="va">conf.ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">colon.cifit</span><span class="op">)</span></span></code></pre></div>
<p>We find that compared to observation alone, the Levamisole alone
treatment group has a -0.03 difference in the cumulative incidence of
death at 2500 days, with 95% confidence interval -0.11, 0.05, while the
Levamisole plus 5-FU group has a -0.13 difference in the cumulative
incidence of death at 2500 days, with 95% confidence interval -0.21,
-0.05. This roughly agrees with the Kaplan-Meier estimates from survfit
above:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>eventglm <span class="op">=</span> <span class="va">b.ci</span>, </span>
<span>      survfit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">colon.sfit</span><span class="op">$</span><span class="va">surv</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>  <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">colon.sfit</span><span class="op">$</span><span class="va">surv</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> </span>
<span>    <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">colon.sfit</span><span class="op">$</span><span class="va">surv</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                eventglm     survfit</span></span>
<span><span class="co">#&gt; (Intercept)  0.54345139  0.54479221</span></span>
<span><span class="co">#&gt; rxLev       -0.02907499 -0.02990601</span></span>
<span><span class="co">#&gt; rxLev+5FU   -0.13175778 -0.13301654</span></span></code></pre></div>
<p>We can fit another model using the log link to obtain estimates of
the log relative risks comparing the active treatment arms to the
observation arm:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colon.rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span>, time <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                      data <span class="op">=</span> <span class="va">colon</span>, link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span><span class="va">br.ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">colon.rr</span><span class="op">)</span></span>
<span><span class="va">confr.ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">colon.rr</span><span class="op">)</span></span></code></pre></div>
<p>We find that the estimated probability of death before 2500 days in
the Levamisole alone arm is 0.95 times lower compared to observation
with 95% confidence interval 0.81, 1.1 and the estimated probability of
death before 2500 days in the Levamisole+5FU arm is 0.76 times lower
compared to observation with 95% confidence interval 0.63, 0.9. If odds
ratios are of interest, then the <code>link = "logit"</code> option can
be used instead. Another interesting option is the
<code>link = "cloglog"</code>: the complementary log log link for the
cumulative incidence implies proportional hazards. Thus models using the
cloglog link applied at various time points can be used to assess the
proportional hazards assumption <span class="citation">(Perme and
Andersen 2008)</span>. Other options for link functions are probit,
inverse, <span class="math inline">\(\mu^{-2}\)</span>, square root, and
users can define custom link function. It is not immediately clear what
the interpretation of the regression coefficients would be in these
cases, but they are possible. See the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">stats::family</a></code> help
file for more details.</p>
<p>Now for the restricted mean:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colon.rmfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmeanglm.html">rmeanglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span>, time <span class="op">=</span> <span class="fl">2500</span>, data <span class="op">=</span> <span class="va">colon</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">colon.rmfit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; rmeanglm(formula = Surv(time, status) ~ rx, time = 2500, data = colon)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -1839.4   -903.8    620.9    829.9    848.1  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) 1667.403     49.949  33.382  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; rxLev         -6.074     71.739  -0.085  0.93253    </span></span>
<span><span class="co">#&gt; rxLev+5FU    194.954     70.498   2.765  0.00569 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 734414066  on 928  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 726392934  on 926  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span>
<span><span class="va">se.rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">colon.rmfit</span>, type <span class="op">=</span> <span class="st">"robust"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b.rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">colon.rmfit</span><span class="op">)</span></span>
<span><span class="va">conf.rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">colon.rmfit</span><span class="op">)</span></span></code></pre></div>
<p>We find that compared to observation alone, the Levamisole alone
treatment group has a -6.07 difference in the mean time to death up to
2500 days, with 95% confidence interval -146.68, 134.53, while the
Levamisole plus 5-FU group has a 194.95 difference in the mean time to
death up to 2500 days, with 95% confidence interval 56.78, 333.13.
Again, this roughly agrees with the Kaplan-Meier estimates from survfit
above:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>eventglm <span class="op">=</span> <span class="va">b.rm</span>, </span>
<span>      survfit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">colon.sfit</span><span class="op">$</span><span class="va">table</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span>, </span>
<span><span class="va">colon.sfit</span><span class="op">$</span><span class="va">table</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">-</span> <span class="va">colon.sfit</span><span class="op">$</span><span class="va">table</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;               eventglm     survfit</span></span>
<span><span class="co">#&gt; (Intercept) 1667.40308 1666.948078</span></span>
<span><span class="co">#&gt; rxLev         -6.07367   -5.708803</span></span>
<span><span class="co">#&gt; rxLev+5FU    194.95446  195.313754</span></span></code></pre></div>
<p>A key advantage of the regression approach is that it gives us the
ability to adjust or model other covariates. In this example, since it
is a randomized trial, we know that all covariates are independent of
treatment assignment. However, several variables are associated with
time to death, so in this case they would be called “precision
variables”. We would expect that adjusting for age, or the number of
positive lymph nodes (more than 4) in the above models would reduce the
standard error estimates of the treatment effects, without changing the
coefficient estimates. Let’s find out:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colon.ci.adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">node4</span>, time <span class="op">=</span> <span class="fl">2500</span>, data <span class="op">=</span> <span class="va">colon</span><span class="op">)</span></span>
<span><span class="va">colon.rm.adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmeanglm.html">rmeanglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">node4</span>, time <span class="op">=</span> <span class="fl">2500</span>, data <span class="op">=</span> <span class="va">colon</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">colon.rm.adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; rmeanglm(formula = Surv(time, status) ~ rx + age + node4, time = 2500, </span></span>
<span><span class="co">#&gt;     data = colon)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -2035.7   -788.5    443.2    647.6   1385.7  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) 2067.576    151.579  13.640  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; rxLev          3.421     67.516   0.051  0.95958    </span></span>
<span><span class="co">#&gt; rxLev+5FU    185.349     67.365   2.751  0.00593 ** </span></span>
<span><span class="co">#&gt; age           -3.735      2.391  -1.562  0.11824    </span></span>
<span><span class="co">#&gt; node4       -644.960     64.854  -9.945  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 734414066  on 928  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 650039827  on 924  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<p>The estimates don’t change (much) and the standard errors reduce by
about 5%.</p>
<div class="section level3">
<h3 id="models-for-survival">Models for survival<a class="anchor" aria-label="anchor" href="#models-for-survival"></a>
</h3>
<p>If you would like to model the survival which is equal to one minus
the cumulative incidence, it is straightforward. You can simply use the
<code>survival = TRUE</code> option:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span>, time <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                      data <span class="op">=</span> <span class="va">colon</span>, survival <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:  cumincglm(formula = Surv(time, status) ~ rx, time = 2500, data = colon, </span></span>
<span><span class="co">#&gt;     survival = TRUE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model for the identity survival at time 2500 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; (Intercept)        rxLev    rxLev+5FU  </span></span>
<span><span class="co">#&gt;     0.45655      0.02907      0.13176  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Degrees of Freedom: 928 Total (i.e. Null);  926 Residual</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multiple-time-points-new-in-version-1-2-0">Multiple time points (New in version 1.2.0)<a class="anchor" aria-label="anchor" href="#multiple-time-points-new-in-version-1-2-0"></a>
</h3>
<p>Now you can specify a vector of times in <code>cumincglm</code> to
get a model that assumes the effect of the covariate is constant over
those times.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mvtfit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span>, </span>
<span>        time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">1500</span>, <span class="fl">2000</span>, <span class="fl">2500</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">colon</span>, survival <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mvtfit1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; cumincglm(formula = Surv(time, status) ~ rx, time = c(500, 1000, </span></span>
<span><span class="co">#&gt;     1500, 2000, 2500), data = colon, survival = TRUE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span></span>
<span><span class="co">#&gt;                                         </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                          Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)              0.829127   0.021793  38.046  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(pseudo.time)1000 -0.170283   0.012340 -13.800  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(pseudo.time)1500 -0.263039   0.014456 -18.196  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(pseudo.time)2000 -0.314852   0.015290 -20.592  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(pseudo.time)2500 -0.351750   0.016423 -21.419  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; rxLev                    0.003942   0.032530   0.121  0.90355    </span></span>
<span><span class="co">#&gt; rxLev+5FU                0.093737   0.031979   2.931  0.00338 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1091.5  on 4644  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 1009.4  on 4638  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<p>In this model, the intercept is the survival probability in the Obs
arm at time 500 (the reference time). The terms labeled
<code>factor(pseudo.time)t</code> represent the change in the intercept
associated with the time <code>t</code>. So, for example, the survival
probability in the Obs arm at time 1000 is 0.83 + -0.17 = 0.66.</p>
<p>Looking at the survival curves in the figure above, the assumption of
a constant treatment effect on the survival difference scale may be
questionable. We can allow covariate effects to be time dependent by
wrapping them in the special term <code>tve()</code> in the right side
of the formula.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mvtfit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fu">tve</span><span class="op">(</span><span class="va">rx</span><span class="op">)</span>, </span>
<span>        time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">1500</span>, <span class="fl">2000</span>, <span class="fl">2500</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">colon</span>, survival <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mvtfit2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; cumincglm(formula = Surv(time, status) ~ tve(rx), time = c(500, </span></span>
<span><span class="co">#&gt;     1000, 1500, 2000, 2500), data = colon, survival = TRUE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span></span>
<span><span class="co">#&gt;                                         </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                                    Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)                        0.850710   0.020078  42.370  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(pseudo.time)1000           -0.178401   0.021560  -8.275  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(pseudo.time)1500           -0.289898   0.025561 -11.341  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(pseudo.time)2000           -0.345379   0.026875 -12.851  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(pseudo.time)2500           -0.394161   0.028857 -13.659  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(pseudo.time)500:rxLev       0.004138   0.028347   0.146  0.88395    </span></span>
<span><span class="co">#&gt; factor(pseudo.time)1000:rxLev     -0.017500   0.037805  -0.463  0.64343    </span></span>
<span><span class="co">#&gt; factor(pseudo.time)1500:rxLev     -0.002754   0.039739  -0.069  0.94474    </span></span>
<span><span class="co">#&gt; factor(pseudo.time)2000:rxLev      0.006751   0.040132   0.168  0.86641    </span></span>
<span><span class="co">#&gt; factor(pseudo.time)2500:rxLev      0.029075   0.041596   0.699  0.48456    </span></span>
<span><span class="co">#&gt; factor(pseudo.time)500:rxLev+5FU   0.027581   0.027476   1.004  0.31546    </span></span>
<span><span class="co">#&gt; factor(pseudo.time)1000:rxLev+5FU  0.074455   0.036360   2.048  0.04059 *  </span></span>
<span><span class="co">#&gt; factor(pseudo.time)1500:rxLev+5FU  0.116689   0.038753   3.011  0.00260 ** </span></span>
<span><span class="co">#&gt; factor(pseudo.time)2000:rxLev+5FU  0.118203   0.039667   2.980  0.00288 ** </span></span>
<span><span class="co">#&gt; factor(pseudo.time)2500:rxLev+5FU  0.131758   0.041722   3.158  0.00159 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1091.5  on 4644  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 1007.9  on 4630  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<p>Now the coefficients labeled
<code>factor(pseudo.time)t:Covariate</code> represent the covariate
effect at time <code>t</code>. So, for example, the difference in
survival probabilities of Levamisole plus 5-FU to Observation at time
1500 is</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mvtfit2</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">13</span>,, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                   Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; factor(pseudo.time)1500:rxLev+5FU     0.12       0.04    3.01        0</span></span></code></pre></div>
<p>Compare with the estimate from survfit:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sfit</span>, times <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span><span class="op">$</span><span class="va">surv</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sfit</span>, times <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span><span class="op">$</span><span class="va">surv</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.12</span></span></code></pre></div>
<p>The key advantage of the regression approach is that we can adjust
for covariates, do inference directly, and have more flexible models.
The <code>tve</code> term allows you to have a mix of time-varying and
time-constant effects. Just apply it to any covariate that you want to
be time-varying.</p>
</div>
</div>
<div class="section level2">
<h2 id="censoring-assumptions">Censoring assumptions<a class="anchor" aria-label="anchor" href="#censoring-assumptions"></a>
</h2>
<p>By default, we assume that time to censoring is independent of the
time to the event, and of all covariates in the model. This is more
restrictive than parametric survival models, or Cox regression, which
only assumes that censoring time is conditionally independent of event
time given the covariates in the model. We provide several options to
relax that assumption using the <code>model.censoring</code> and
<code>formula.censoring</code> options. The first is to compute
stratified pseudo observations, which assumes that the censoring is
independent given a set of categorical covariates:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colon.ci.cen1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">node4</span>, time <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                           data <span class="op">=</span> <span class="va">colon</span>, model.censoring <span class="op">=</span> <span class="st">"stratified"</span>, </span>
<span>                           formula.censoring <span class="op">=</span> <span class="op">~</span> <span class="va">rx</span><span class="op">)</span></span></code></pre></div>
<p>Next, we can assume that the time to censoring follows a Cox model
given a set of covariates. By default, the same covariate formula (right
hand side) as the main model is used, but any formula can be specified.
We can also use Aalens additive hazards model instead of a Cox model for
the censoring distribution. Then inverse probability of censoring
weighted pseudo observations are used <span class="citation">(Overgaard,
Parner, and Pedersen 2019)</span>. According to our simulation study,
the stratified option works quite well even when the censoring model is
misspecified, and the Aalen additive model tends to work better than the
Cox model.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colon.ci.cen2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">node4</span>, time <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                           data <span class="op">=</span> <span class="va">colon</span>, model.censoring <span class="op">=</span> <span class="st">"coxph"</span>, </span>
<span>                           formula.censoring <span class="op">=</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">node4</span><span class="op">)</span></span>
<span><span class="va">colon.ci.cen3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">node4</span>, time <span class="op">=</span> <span class="fl">2500</span>, </span>
<span>                           data <span class="op">=</span> <span class="va">colon</span>, model.censoring <span class="op">=</span> <span class="st">"aareg"</span>, </span>
<span>                           formula.censoring <span class="op">=</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">node4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"indep"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">colon.ci.adj</span><span class="op">)</span>,</span>
<span>  <span class="st">"strat"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">colon.ci.cen1</span><span class="op">)</span>,</span>
<span>  <span class="st">"coxipcw"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">colon.ci.cen2</span><span class="op">)</span>,</span>
<span>  <span class="st">"aalenipcw"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">colon.ci.cen3</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;              indep  strat coxipcw aalenipcw</span></span>
<span><span class="co">#&gt; (Intercept)  0.318  0.314   0.535     0.596</span></span>
<span><span class="co">#&gt; rxLev       -0.034 -0.035  -0.034    -0.036</span></span>
<span><span class="co">#&gt; rxLev+5FU   -0.127 -0.128  -0.127    -0.127</span></span>
<span><span class="co">#&gt; age          0.002  0.002   0.002     0.002</span></span>
<span><span class="co">#&gt; node4        0.332  0.334   0.335     0.334</span></span></code></pre></div>
<p>In these models, the IPCW weights are returned in the element called
“ipcw.weights”. If there are multiple time points, this will be a matrix
with one column per time point.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colon.ci.cen2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">node4</span>, </span>
<span>                            time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2500</span><span class="op">)</span>, </span>
<span>                           data <span class="op">=</span> <span class="va">colon</span>, model.censoring <span class="op">=</span> <span class="st">"coxph"</span>, </span>
<span>                           formula.censoring <span class="op">=</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">node4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">colon.ci.cen2b</span><span class="op">$</span><span class="va">ipcw.weights</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.9988156 0.9988156 0.9936251</span></span>
<span><span class="co">#&gt; [2,] 0.9988733 0.9988733 0.3867807</span></span>
<span><span class="co">#&gt; [3,] 0.9983923 0.9983923 0.9983923</span></span>
<span><span class="co">#&gt; [4,] 1.0000000 1.0000000 1.0000000</span></span>
<span><span class="co">#&gt; [5,] 0.9984112 0.9984112 0.9984112</span></span>
<span><span class="co">#&gt; [6,] 0.9987135 0.9987135 0.9911426</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">colon.ci.cen2b</span><span class="op">$</span><span class="va">ipcw.weights</span><span class="op">)</span></span>
<span><span class="co">#&gt;        V1               V2               V3        </span></span>
<span><span class="co">#&gt;  Min.   :0.9983   Min.   :0.9983   Min.   :0.2702  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.9987   1st Qu.:0.9987   1st Qu.:0.4832  </span></span>
<span><span class="co">#&gt;  Median :0.9988   Median :0.9988   Median :0.9094  </span></span>
<span><span class="co">#&gt;  Mean   :0.9989   Mean   :0.9989   Mean   :0.7680  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.9989   3rd Qu.:0.9989   3rd Qu.:0.9988  </span></span>
<span><span class="co">#&gt;  Max.   :1.0000   Max.   :1.0000   Max.   :1.0000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="monoclonal-gammopathy-data-competing-risks">Monoclonal gammopathy data (Competing risks)<a class="anchor" aria-label="anchor" href="#monoclonal-gammopathy-data-competing-risks"></a>
</h2>
<p>Our next example involves the <code>mgus2</code> dataset, included in
the package:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ?mgus2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mgus2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id age sex dxyr  hgb creat mspike ptime pstat futime death etime event</span></span>
<span><span class="co">#&gt; 1  1  88   F 1981 13.1   1.3    0.5    30     0     30     1    30 death</span></span>
<span><span class="co">#&gt; 2  2  78   F 1968 11.5   1.2    2.0    25     0     25     1    25 death</span></span>
<span><span class="co">#&gt; 3  3  94   M 1980 10.5   1.5    2.6    46     0     46     1    46 death</span></span>
<span><span class="co">#&gt; 4  4  68   M 1977 15.2   1.2    1.2    92     0     92     1    92 death</span></span>
<span><span class="co">#&gt; 5  5  90   F 1973 10.7   0.8    1.0     8     0      8     1     8 death</span></span>
<span><span class="co">#&gt; 6  6  90   M 1990 12.9   1.0    0.5     4     0      4     1     4 death</span></span></code></pre></div>
<p>This dataset has a number of covariates, and the time until
progression to plasma cell malignancy (PCM), or death. Here the event
PCM is of primary interest, with death being a competing event. The data
are described and analyzed in the survival vignette (section 2.3.2):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span>, <span class="fu">eventglm</span><span class="fu">::</span><span class="va"><a href="../reference/mgus2.html">mgus2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">crfit</span>, times <span class="op">=</span> <span class="fl">120</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call: survfit(formula = Surv(etime, event) ~ sex, data = eventglm::mgus2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 sex=F </span></span>
<span><span class="co">#&gt;     time   n.risk  n.event  P((s0))   P(pcm) P(death) </span></span>
<span><span class="co">#&gt; 120.0000 214.0000 331.0000   0.4456   0.0739   0.4805 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 sex=M </span></span>
<span><span class="co">#&gt;     time   n.risk  n.event  P((s0))   P(pcm) P(death) </span></span>
<span><span class="co">#&gt; 120.0000 210.0000 450.0000   0.3695   0.0553   0.5752</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">crfit</span>, rmean <span class="op">=</span> <span class="fl">120</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call: survfit(formula = Surv(etime, event) ~ sex, data = eventglm::mgus2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                n nevent    rmean*</span></span>
<span><span class="co">#&gt; sex=F, (s0)  631      0 82.983485</span></span>
<span><span class="co">#&gt; sex=M, (s0)  753      0 74.808346</span></span>
<span><span class="co">#&gt; sex=F, pcm   631     59  4.794595</span></span>
<span><span class="co">#&gt; sex=M, pcm   753     56  3.501305</span></span>
<span><span class="co">#&gt; sex=F, death 631    370 32.221921</span></span>
<span><span class="co">#&gt; sex=M, death 753    490 41.690349</span></span>
<span><span class="co">#&gt;    *restricted mean time in state (max time = 120 )</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">crfit</span>, col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,  noplot<span class="op">=</span><span class="st">""</span>,</span>
<span>     lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">2</span>, xscale<span class="op">=</span><span class="fl">12</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Years post diagnosis"</span>, ylab<span class="op">=</span><span class="st">"P(state)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">240</span>, <span class="fl">.65</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Female, death"</span>, <span class="st">"Male, death"</span>, <span class="st">"malignancy"</span>, <span class="st">"(s0)"</span><span class="op">)</span>,</span>
<span>       lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, bty<span class="op">=</span><span class="st">'n'</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">120</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<p>We can get similar estimates for the cumulative incidence of pcm at
10 years and the expected lifetime lost due to pcm up to 10 years with
similar commands as above. Note the <code>cause</code> option to specify
the cause of interest.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mgfitci</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span>, cause <span class="op">=</span> <span class="st">"pcm"</span>, time <span class="op">=</span> <span class="fl">120</span>, </span>
<span>                   data <span class="op">=</span> <span class="va">mgus2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mgfitci</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; cumincglm(formula = Surv(etime, event) ~ sex, time = 120, cause = "pcm", </span></span>
<span><span class="co">#&gt;     data = mgus2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;      Min        1Q    Median        3Q       Max  </span></span>
<span><span class="co">#&gt; -0.08163  -0.07447  -0.06306  -0.05536   1.23923  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)  0.07383    0.01086   6.800 1.04e-11 ***</span></span>
<span><span class="co">#&gt; sexM        -0.01857    0.01384  -1.342     0.18    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 88.507  on 1383  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 88.388  on 1382  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span>
<span></span>
<span><span class="va">mgfitrmean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmeanglm.html">rmeanglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span>, cause <span class="op">=</span> <span class="st">"pcm"</span>, time <span class="op">=</span> <span class="fl">120</span>, </span>
<span>                       data <span class="op">=</span> <span class="va">mgus2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mgfitrmean</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; rmeanglm(formula = Surv(etime, event) ~ sex, time = 120, cause = "pcm", </span></span>
<span><span class="co">#&gt;     data = mgus2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt;  -4.971   -4.863   -3.678   -3.508  113.292  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)   4.7926     0.7883   6.080  1.2e-09 ***</span></span>
<span><span class="co">#&gt; sexM         -1.2929     0.9902  -1.306    0.192    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 450225  on 1383  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 449652  on 1382  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<p>Sex may be an important predictor of time to pcm, what about the
other variables?</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mgfitci2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">hgb</span>, cause <span class="op">=</span> <span class="st">"pcm"</span>, </span>
<span>                      time <span class="op">=</span> <span class="fl">120</span>, data <span class="op">=</span> <span class="va">mgus2</span><span class="op">)</span></span>
<span><span class="va">mgfitrmean2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmeanglm.html">rmeanglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">hgb</span>, cause <span class="op">=</span> <span class="st">"pcm"</span>, </span>
<span>                      time <span class="op">=</span> <span class="fl">120</span>, data <span class="op">=</span> <span class="va">mgus2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mgfitrmean2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; rmeanglm(formula = Surv(etime, event) ~ sex + age + hgb, time = 120, </span></span>
<span><span class="co">#&gt;     cause = "pcm", data = mgus2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt;  -7.081   -4.795   -4.034   -3.278  112.970  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; (Intercept)  3.98253    3.87360   1.028    0.304</span></span>
<span><span class="co">#&gt; sexM        -0.98992    0.99168  -0.998    0.318</span></span>
<span><span class="co">#&gt; age          0.04466    0.02941   1.518    0.129</span></span>
<span><span class="co">#&gt; hgb         -0.18754    0.25091  -0.747    0.455</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 448531  on 1370  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 447319  on 1367  degrees of freedom</span></span>
<span><span class="co">#&gt;   (13 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; AIC: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<p>The objects returned by <code>cumincglm</code> and
<code>rmeanglm</code> inherit from <code>glm</code>, so many methods are
available. First, the <code>vcov</code> function has several options for
calculation of the estimated variance of the estimated regression
parameters. By default, the <code>robust</code> variance estimates are
used, based on the Huber-White estimator. Other options are naive, and
corrected, which are the corrected estimators suggested by <span class="citation">Overgaard et al. (2017)</span> which are based on a
second order Von-Mises expansion. We can also use the bootstrap. This
recalculated the pseudo-observations every time, but it is still pretty
fast because of the C code. Let’s compare:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nboot</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># use a bigger number for real</span></span>
<span><span class="va">bootests</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">nboot</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nboot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mgus.b</span> <span class="op">&lt;-</span> <span class="va">mgus2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mgus2</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">mgfitrmean.b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmeanglm.html">rmeanglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">hgb</span>, cause <span class="op">=</span> <span class="st">"pcm"</span>, </span>
<span>                      time <span class="op">=</span> <span class="fl">120</span>, data <span class="op">=</span> <span class="va">mgus.b</span><span class="op">)</span></span>
<span>  <span class="va">bootests</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">mgfitrmean.b</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">se.boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">bootests</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>se.boot <span class="op">=</span> <span class="va">se.boot</span>, </span>
<span>      se.robust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mgfitrmean2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>      <span class="co">#se.corrected = sqrt(diag(vcov(mgfitrmean2, type = "corrected"))), </span></span>
<span>      se.naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mgfitrmean2</span>, type <span class="op">=</span> <span class="st">"naive"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">se.boot</th>
<th align="right">se.robust</th>
<th align="right">se.naive</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">3.922</td>
<td align="right">3.874</td>
<td align="right">4.749</td>
</tr>
<tr class="even">
<td align="left">sexM</td>
<td align="right">0.869</td>
<td align="right">0.992</td>
<td align="right">1.012</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="right">0.029</td>
<td align="right">0.029</td>
<td align="right">0.041</td>
</tr>
<tr class="even">
<td align="left">hgb</td>
<td align="right">0.245</td>
<td align="right">0.251</td>
<td align="right">0.253</td>
</tr>
</tbody>
</table>
<p>The corrected estimator fails pretty often, because it doesn’t handle
ties, and the benefits are negligible, and thus may be removed from the
package in the future.</p>
<p>Residuals also work, using the scaling factor suggested by <span class="citation">Perme and Andersen (2008)</span>, as do predictions.
Predicted restricted means give a possible method to predict individual
event times, while the predicted cumulative incidence should be
probabilities. Note that with the identity link, the predicted
cumulative incidence is not guaranteed to be between 0 and 1.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mgfitrmean2</span>, newdata <span class="op">=</span> <span class="va">mgus2</span><span class="op">)</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Predicted lifetime lost due to PCM"</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mgus2</span><span class="op">$</span><span class="va">prob.pcm10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mgfitci2</span>, newdata <span class="op">=</span> <span class="va">mgus2</span><span class="op">)</span></span>
<span><span class="va">mgus2</span><span class="op">$</span><span class="va">pseudo.ci</span> <span class="op">&lt;-</span> <span class="va">mgfitci</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mgus2</span><span class="op">$</span><span class="va">prob.pcm10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt; 0.05169 0.05559 0.05695 0.06348 0.07297 0.07522      13</span></span>
<span><span class="va">cutps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">mgus2</span><span class="op">$</span><span class="va">prob.pcm10</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.9</span>, by <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mgus2</span><span class="op">$</span><span class="va">prob.cut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">mgus2</span><span class="op">$</span><span class="va">prob.pcm10</span>, </span>
<span>                      <span class="va">cutps</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred.p</span> <span class="op">&lt;-</span> <span class="va">cutps</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cutps</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">cutps</span><span class="op">)</span></span>
<span><span class="va">obs.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">mgus2</span><span class="op">$</span><span class="va">pseudo.ci</span>, <span class="va">mgus2</span><span class="op">$</span><span class="va">prob.cut</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obs.p</span> <span class="op">~</span> <span class="va">pred.p</span>, xlab <span class="op">=</span> <span class="st">"predicted"</span>, ylab <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-25-2.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="relative-survivalnet-survival">Relative survival/net survival<a class="anchor" aria-label="anchor" href="#relative-survivalnet-survival"></a>
</h2>
<p>Following Professor Paul Lambert’s example here: <a href="https://pclambert.net/software/stpp/using_stpp/" class="external-link uri">https://pclambert.net/software/stpp/using_stpp/</a> , let’s
load the datasets:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># from https://pclambert.net/data/colon.dta</span></span>
<span><span class="va">colon2</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html" class="external-link">import</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"colon.dta"</span>, package <span class="op">=</span> <span class="st">"eventglm"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">colon2</span><span class="op">$</span><span class="va">surv_mm_trunc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">colon2</span><span class="op">$</span><span class="va">surv_mm</span> <span class="op">&gt;</span> <span class="fl">120.5</span>, <span class="fl">120.5</span>, <span class="va">colon2</span><span class="op">$</span><span class="va">surv_mm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colon2</span><span class="op">$</span><span class="va">death</span> <span class="op">&lt;-</span> <span class="va">colon2</span><span class="op">$</span><span class="va">status</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">colon2</span><span class="op">$</span><span class="va">death</span><span class="op">[</span><span class="va">colon2</span><span class="op">$</span><span class="va">surv_mm</span> <span class="op">&gt;</span> <span class="va">colon2</span><span class="op">$</span><span class="va">surv_mm_trunc</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># from https://pclambert.net/data/popmort.dta</span></span>
<span><span class="va">lifetab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html" class="external-link">import</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"popmort.dta"</span>, package <span class="op">=</span> <span class="st">"eventglm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we will estimate the marginal relative survival using the
approach described in <span class="citation">Pavlič and Pohar Perme
(2019)</span>, which is based on the estimator:</p>
<p><span class="math display">\[
RS(t) = n^{-1}\sum_{i = 1}^n\frac{PO_i(t)}{S_{P}(t | D)},
\]</span></p>
<p>where <span class="math inline">\(S_{P}(t | D)\)</span> is the
survival probability based on the life tables for the demographics <span class="math inline">\(D\)</span> of patient <span class="math inline">\(i\)</span>, and <span class="math inline">\(PO_i(t)\)</span> are the pseudo observations for
time <span class="math inline">\(t\)</span>. We get the survival
probability by merging with the life table estimates, and the pseudo
observations from our package. The <code>prob</code> from the life
tables is the probability of surviving one year, so to get the
probability of surviving 5 and 10 years, we need to calculate the
cumulative product estimates.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">lifetab</span><span class="op">[</span>, <span class="va">prob.5</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">lifetab</span><span class="op">[</span><span class="va">`_age`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.BY</span><span class="op">[[</span><span class="st">"_age"</span><span class="op">]</span><span class="op">]</span><span class="op">:</span><span class="op">(</span><span class="va">.BY</span><span class="op">[[</span><span class="st">"_age"</span><span class="op">]</span><span class="op">]</span><span class="op">+</span><span class="fl">4</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>                              <span class="va">`_year`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.BY</span><span class="op">[[</span><span class="st">"_year"</span><span class="op">]</span><span class="op">]</span><span class="op">:</span><span class="op">(</span><span class="va">.BY</span><span class="op">[[</span><span class="st">"_year"</span><span class="op">]</span><span class="op">]</span><span class="op">+</span><span class="fl">4</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>                                <span class="va">`_year`</span> <span class="op">==</span> <span class="va">.BY</span><span class="op">[[</span><span class="st">"_year"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">.BY</span><span class="op">[[</span><span class="st">"_age"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">`_age`</span> <span class="op">&amp;</span></span>
<span>                              <span class="va">sex</span> <span class="op">==</span> <span class="va">.BY</span><span class="op">[[</span><span class="st">"sex"</span><span class="op">]</span><span class="op">]</span> <span class="op">]</span><span class="op">$</span><span class="va">prob</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"_year"</span>, <span class="st">"_age"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">lifetab</span><span class="op">[</span>, <span class="va">prob.10</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">lifetab</span><span class="op">[</span><span class="va">`_age`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.BY</span><span class="op">[[</span><span class="st">"_age"</span><span class="op">]</span><span class="op">]</span><span class="op">:</span><span class="op">(</span><span class="va">.BY</span><span class="op">[[</span><span class="st">"_age"</span><span class="op">]</span><span class="op">]</span><span class="op">+</span><span class="fl">9</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>                              <span class="va">`_year`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.BY</span><span class="op">[[</span><span class="st">"_year"</span><span class="op">]</span><span class="op">]</span><span class="op">:</span><span class="op">(</span><span class="va">.BY</span><span class="op">[[</span><span class="st">"_year"</span><span class="op">]</span><span class="op">]</span><span class="op">+</span><span class="fl">9</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>                                <span class="va">`_year`</span> <span class="op">==</span> <span class="va">.BY</span><span class="op">[[</span><span class="st">"_year"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">.BY</span><span class="op">[[</span><span class="st">"_age"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">`_age`</span> <span class="op">&amp;</span></span>
<span>                              <span class="va">sex</span> <span class="op">==</span> <span class="va">.BY</span><span class="op">[[</span><span class="st">"sex"</span><span class="op">]</span><span class="op">]</span> <span class="op">]</span><span class="op">$</span><span class="va">prob</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"_year"</span>, <span class="st">"_age"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">colon2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">colon2</span>, <span class="va">lifetab</span>, </span>
<span>                by.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"yydx"</span>, <span class="st">"age"</span><span class="op">)</span>, </span>
<span>                by.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>,  <span class="st">"_year"</span>, <span class="st">"_age"</span><span class="op">)</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span>, all.y <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">surv_mm_trunc</span>, <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">colon2</span>, time <span class="op">=</span> <span class="fl">1</span> <span class="op">*</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">fit5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">surv_mm_trunc</span>, <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">colon2</span>, time <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">fit10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">surv_mm_trunc</span>, <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">colon2</span>, time <span class="op">=</span> <span class="fl">10</span> <span class="op">*</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colon2</span><span class="op">$</span><span class="va">po_1</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">colon2</span><span class="op">$</span><span class="va">po_5</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">fit5</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">colon2</span><span class="op">$</span><span class="va">po_10</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">fit10</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>                   relsurv.pseudo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">colon2</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">po_1</span> <span class="op">/</span> <span class="va">prob</span><span class="op">)</span>, </span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">po_5</span> <span class="op">/</span> <span class="va">prob.5</span><span class="op">)</span>, </span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">po_10</span> <span class="op">/</span> <span class="va">prob.10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  <span class="op">)</span>,</span>
<span>                   relsurv.pohar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.682</span>, <span class="fl">0.479</span>, <span class="fl">0.441</span><span class="op">)</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">time</th>
<th align="right">relsurv.pseudo</th>
<th align="right">relsurv.pohar</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.677</td>
<td align="right">0.682</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">0.477</td>
<td align="right">0.479</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">0.411</td>
<td align="right">0.441</td>
</tr>
</tbody>
</table>
<p>They are pretty close to those computed using the Pohar Perme
estimator reported by Prof Lambert.</p>
</div>
<div class="section level2">
<h2 id="case-cohort-sampling">Case cohort sampling<a class="anchor" aria-label="anchor" href="#case-cohort-sampling"></a>
</h2>
<p><span class="citation">Parner, Andersen, and Overgaard (2020)</span>
describe how to fit regression models with pseudo-observations that
account for case-cohort sampling. The basic idea is weighted estimating
equations, which we can implement easily with the <code>weights</code>
argument that gets passed to <code>glm.fit</code>. First let’s create a
case-cohort sample of the <code>colon2</code> dataset by sampling the
cancer deaths (<code>status == 1</code>) with probability 0.8, and a
random subcohort with probability 0.1.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colon2</span><span class="op">$</span><span class="va">status2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">colon2</span><span class="op">$</span><span class="va">status</span> <span class="op">==</span> <span class="fl">4</span>, <span class="fl">0</span>, <span class="va">colon2</span><span class="op">$</span><span class="va">status</span><span class="op">)</span>, </span>
<span>                         labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"censored"</span>, <span class="st">"cancer death"</span>, <span class="st">"other death"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">subc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">colon2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, p <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span></span>
<span><span class="va">samp.ind</span> <span class="op">&lt;-</span> <span class="va">subc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">subc</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">colon2</span><span class="op">$</span><span class="va">status</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">colon2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, p <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span></span>
<span><span class="va">colon.cc</span> <span class="op">&lt;-</span> <span class="va">colon2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">samp.ind</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">colon.cc</span><span class="op">$</span><span class="va">samp.wt</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">colon.cc</span><span class="op">$</span><span class="va">status</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">.2</span> <span class="op">+</span> <span class="fl">.8</span> <span class="op">*</span> <span class="fl">.9</span>, <span class="fl">.2</span><span class="op">)</span></span></code></pre></div>
<p>Now, the weighted regression model should give similar results as the
unweighted one in the full sample:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfit.cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">surv_mm</span>, <span class="va">status2</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">subsite</span><span class="op">)</span>, </span>
<span>                     cause <span class="op">=</span> <span class="st">"cancer death"</span>, time <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">12</span>, data <span class="op">=</span> <span class="va">colon.cc</span>, </span>
<span>                     weights <span class="op">=</span> <span class="va">samp.wt</span><span class="op">)</span></span>
<span><span class="va">cfit.full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">surv_mm</span>, <span class="va">status2</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">subsite</span><span class="op">)</span>, </span>
<span>                     cause <span class="op">=</span> <span class="st">"cancer death"</span>, time <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">12</span>, data <span class="op">=</span> <span class="va">colon2</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>casecohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">cfit.cc</span><span class="op">)</span>, </span>
<span>      fullsamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">cfit.full</span><span class="op">)</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">casecohort</th>
<th align="right">fullsamp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.23</td>
<td align="right">0.21</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">-0.01</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">factor(subsite)2</td>
<td align="right">0.07</td>
<td align="right">0.06</td>
</tr>
<tr class="odd">
<td align="left">factor(subsite)3</td>
<td align="right">-0.01</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">factor(subsite)4</td>
<td align="right">-0.01</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-overgaard2017asymptotic" class="csl-entry">
Overgaard, Morten, Erik Thorlund Parner, Jan Pedersen, et al. 2017.
<span>“Asymptotic Theory of Generalized Estimating Equations Based on
Jack-Knife Pseudo-Observations.”</span> <em>The Annals of
Statistics</em> 45 (5): 1988–2015.
</div>
<div id="ref-overgaard2019pseudo" class="csl-entry">
Overgaard, Morten, Erik Thorlund Parner, and Jan Pedersen. 2019.
<span>“Pseudo-Observations Under Covariate-Dependent Censoring.”</span>
<em>Journal of Statistical Planning and Inference</em> 202: 112–22.
</div>
<div id="ref-parner2020cumulative" class="csl-entry">
Parner, Erik T, Per K Andersen, and Morten Overgaard. 2020.
<span>“Cumulative Risk Regression in Case–Cohort Studies Using
Pseudo-Observations.”</span> <em>Lifetime Data Analysis</em>, 1–20.
</div>
<div id="ref-pavlivc2019using" class="csl-entry">
Pavlič, Klemen, and Maja Pohar Perme. 2019. <span>“Using
Pseudo-Observations for Estimation in Relative Survival.”</span>
<em>Biostatistics</em> 20 (3): 384–99.
</div>
<div id="ref-perme2008checking" class="csl-entry">
Perme, Maja Pohar, and Per Kragh Andersen. 2008. <span>“Checking Hazard
Regression Models Using Pseudo-Observations.”</span> <em>Statistics in
Medicine</em> 27 (25): 5309–28.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael C Sachs, Erin E Gabriel.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
