<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Examples of using eventglm and interpreting the results • eventglm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Examples of using eventglm and interpreting the results">
<meta property="og:description" content="eventglm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eventglm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example-analysis.html">Examples of using eventglm and interpreting the results</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sachsmc/eventglm/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example-analysis_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Examples of using eventglm and interpreting the results</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sachsmc/eventglm/blob/master/vignettes/example-analysis.Rmd"><code>vignettes/example-analysis.Rmd</code></a></small>
      <div class="hidden name"><code>example-analysis.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">survival</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">eventglm</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'eventglm'</span>
<span class="co">#&gt; The following objects are masked from 'package:survival':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     colon, mgus2</span></pre></body></html></div>
<div id="colon-cancer-treatment-and-time-to-death-standard-survival" class="section level1">
<h1 class="hasAnchor">
<a href="#colon-cancer-treatment-and-time-to-death-standard-survival" class="anchor"></a>Colon cancer treatment and time to death (standard survival)</h1>
<p>Our first example concerns the <code>colon</code> dataset, which is included in the package:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r">?<span class="kw pkg">eventglm</span><span class="kw ns">::</span><span class="no"><a href="../reference/colon.html">colon</a></span></pre></body></html></div>
<p>This is a randomized trial, so the main interest is in comparing the distributions of time to death between the three treatment arms. Let’s start with a survival curve.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">sfit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">time</span>, <span class="no">status</span>) ~ <span class="no">rx</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">sfit</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"slateblue"</span>, <span class="st">"salmon"</span>),
     <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"days since registration"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"survival"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomleft"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"slateblue"</span>, <span class="st">"salmon"</span>),
       <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">sfit</span>$<span class="no">strata</span>))</pre></body></html></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>As we know, hazard ratios are difficult to interpret as causal effects, even in randomized controlled trials. Better options for summarizing the effect of treatment are the survival at a particular time, or the restricted mean survival up to a given time. Let’s compare the survival at 7 years, or about 2500 days since registration.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">sfit</span>[<span class="fl">1</span>], <span class="kw">conf.int</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"days since registration"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"survival"</span>)

<span class="no">seg0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">sfit</span>[<span class="fl">1</span>], <span class="kw">times</span> <span class="kw">=</span> <span class="no">sfit</span>[<span class="fl">1</span>]$<span class="no">time</span>[<span class="no">sfit</span>[<span class="fl">1</span>]$<span class="no">time</span> <span class="kw">&lt;=</span> <span class="fl">2500</span>])
<span class="fu"><a href="https://rdrr.io/r/graphics/rect.html">rect</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">seg0</span>$<span class="no">time</span>), <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">seg0</span>$<span class="no">time</span>, <span class="fl">2500</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">seg0</span>$<span class="no">surv</span>),
     <span class="kw">border</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"grey80"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">sfit</span>[<span class="fl">1</span>], <span class="kw">conf.int</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">v</span> <span class="kw">=</span> <span class="fl">2500</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fl">2500</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">sfit</span>[<span class="fl">1</span>], <span class="kw">times</span> <span class="kw">=</span> <span class="fl">2500</span>)$<span class="no">surv</span>)</pre></body></html></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>In the figure above, we plot only the survival curve in the observation group. The vertical dotted line is at the time of interest (tmax = 2500 days). The open point is at the estimated survival probability at time tmax, i.e., <span class="math inline">\(P(T &gt; tmax)\)</span> and the shaded area represents the restricted mean survival up to tmax, i.e., <span class="math inline">\(E\{\min(T, tmax)\} = \int_0^{tmax} P(T &gt; u) \, du\)</span>. We can estimate these things using the <code>survival</code> package:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">colon.sfit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">sfit</span>, <span class="kw">times</span> <span class="kw">=</span> <span class="fl">2500</span>, <span class="kw">rmean</span> <span class="kw">=</span> <span class="fl">2500</span>)
<span class="no">colon.sfit</span>
<span class="co">#&gt; Call: survfit(formula = Surv(time, status) ~ rx, data = colon)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                 rx=Obs </span>
<span class="co">#&gt;         time       n.risk      n.event     survival      std.err lower 95% CI </span>
<span class="co">#&gt;     2.50e+03     5.00e+01     1.65e+02     4.55e-01     2.98e-02     4.00e-01 </span>
<span class="co">#&gt; upper 95% CI </span>
<span class="co">#&gt;     5.18e-01 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                 rx=Lev </span>
<span class="co">#&gt;         time       n.risk      n.event     survival      std.err lower 95% CI </span>
<span class="co">#&gt;     2.50e+03     5.80e+01     1.57e+02     4.85e-01     2.92e-02     4.31e-01 </span>
<span class="co">#&gt; upper 95% CI </span>
<span class="co">#&gt;     5.46e-01 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                 rx=Lev+5FU </span>
<span class="co">#&gt;         time       n.risk      n.event     survival      std.err lower 95% CI </span>
<span class="co">#&gt;     2.50e+03     6.50e+01     1.21e+02     5.88e-01     2.96e-02     5.33e-01 </span>
<span class="co">#&gt; upper 95% CI </span>
<span class="co">#&gt;     6.49e-01</span></pre></body></html></div>
<p>And we can now do inference using the <code>eventglm</code> package. First, we fit a regression model for the cumulative incidence, or 1 - survival:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">colon.cifit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">time</span>, <span class="no">status</span>) ~ <span class="no">rx</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">2500</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">colon.cifit</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; cumincglm(formula = Surv(time, status) ~ rx, time = 2500, data = colon)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -0.5875  -0.4902  -0.3467   0.4863   2.1103  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)  0.54345    0.02946  18.449  &lt; 2e-16 ***</span>
<span class="co">#&gt; rxLev       -0.02907    0.04173  -0.697  0.48596    </span>
<span class="co">#&gt; rxLev+5FU   -0.13176    0.04186  -3.148  0.00165 ** </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 253.10  on 928  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 250.15  on 926  degrees of freedom</span>
<span class="co">#&gt; AIC: NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 2</span>
<span class="no">se.ci</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span>(<span class="no">colon.cifit</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"robust"</span>)))
<span class="no">b.ci</span> <span class="kw">&lt;-</span> <span class="no">colon.cifit</span>$<span class="no">coefficients</span></pre></body></html></div>
<p>We find that compared to observation alone, the Levamisole alone treatment group has a -0.03 difference in the cumulative incidence of death at 2500 days, with 95% confidence interval -0.11, 0.05, while the Levamisole plus 5-FU group has a -0.13 difference in the cumulative incidence of death at 2500 days, with 95% confidence interval -0.21, -0.05. This roughly agrees with the Kaplan-Meier estimates from survfit above:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">eventglm</span> <span class="kw">=</span> <span class="no">b.ci</span>,
      <span class="kw">survfit</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span> - <span class="no">colon.sfit</span>$<span class="no">surv</span>[<span class="fl">1</span>],
  (<span class="fl">1</span> - <span class="no">colon.sfit</span>$<span class="no">surv</span>[<span class="fl">2</span>:<span class="fl">3</span>]) -
    (<span class="fl">1</span> - <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">colon.sfit</span>$<span class="no">surv</span>[<span class="fl">1</span>], <span class="fl">2</span>))))
<span class="co">#&gt;                eventglm     survfit</span>
<span class="co">#&gt; (Intercept)  0.54345139  0.54479221</span>
<span class="co">#&gt; rxLev       -0.02907499 -0.02990601</span>
<span class="co">#&gt; rxLev+5FU   -0.13175778 -0.13301654</span></pre></body></html></div>
<p>Now for the restricted mean:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">colon.rmfit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rmeanglm.html">rmeanglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">time</span>, <span class="no">status</span>) ~ <span class="no">rx</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">2500</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">colon.rmfit</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; rmeanglm(formula = Surv(time, status) ~ rx, time = 2500, data = colon)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -1839.4   -903.8    620.9    829.9    848.1  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept) 1667.403     49.949  33.382  &lt; 2e-16 ***</span>
<span class="co">#&gt; rxLev         -6.074     71.739  -0.085  0.93253    </span>
<span class="co">#&gt; rxLev+5FU    194.954     70.498   2.765  0.00569 ** </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 734414066  on 928  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 726392934  on 926  degrees of freedom</span>
<span class="co">#&gt; AIC: NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 2</span>
<span class="no">se.rm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span>(<span class="no">colon.rmfit</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"robust"</span>)))
<span class="no">b.rm</span> <span class="kw">&lt;-</span> <span class="no">colon.rmfit</span>$<span class="no">coefficients</span></pre></body></html></div>
<p>We find that compared to observation alone, the Levamisole alone treatment group has a -6.07 difference in the mean time to death up to 2500 days, with 95% confidence interval -146.68, 134.54, while the Levamisole plus 5-FU group has a 194.95 difference in the mean time to death up to 2500 days, with 95% confidence interval 56.78, 333.13. Again, this roughly agrees with the Kaplan-Meier estimates from survfit above:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">eventglm</span> <span class="kw">=</span> <span class="no">b.rm</span>,
      <span class="kw">survfit</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">colon.sfit</span>$<span class="no">table</span>[<span class="fl">1</span>, <span class="fl">5</span>],
<span class="no">colon.sfit</span>$<span class="no">table</span>[<span class="fl">2</span>:<span class="fl">3</span>, <span class="fl">5</span>] - <span class="no">colon.sfit</span>$<span class="no">table</span>[<span class="fl">1</span>, <span class="fl">5</span>]))
<span class="co">#&gt;               eventglm     survfit</span>
<span class="co">#&gt; (Intercept) 1667.40308 1666.948078</span>
<span class="co">#&gt; rxLev         -6.07367   -5.708803</span>
<span class="co">#&gt; rxLev+5FU    194.95446  195.313754</span></pre></body></html></div>
<p>A key advantage of the regression approach is that it gives us the ability to adjust or model other covariates. In this example, since it is a randomized trial, we know that all covariates are independent of treatment assignment. However, several variables are associated with time to death, so in this case they would be called “precision variables”. We would expect that adjusting for age, or the number of positive lymph nodes (more than 4) in the above models would reduce the standard error estimates of the treatment effects, without changing the coefficient estimates. Let’s find out:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">colon.ci.adj</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">time</span>, <span class="no">status</span>) ~ <span class="no">rx</span> + <span class="no">age</span> + <span class="no">node4</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">2500</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">colon.ci.adj</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; cumincglm(formula = Surv(time, status) ~ rx + age + node4, time = 2500, </span>
<span class="co">#&gt;     data = colon)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -0.8403  -0.4219  -0.2658   0.5363   1.9691  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)  0.318198   0.089345   3.561 0.000369 ***</span>
<span class="co">#&gt; rxLev       -0.034176   0.040096  -0.852 0.394016    </span>
<span class="co">#&gt; rxLev+5FU   -0.126894   0.040388  -3.142 0.001679 ** </span>
<span class="co">#&gt; age          0.002247   0.001403   1.602 0.109197    </span>
<span class="co">#&gt; node4        0.331968   0.036077   9.202  &lt; 2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 253.10  on 928  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 229.85  on 924  degrees of freedom</span>
<span class="co">#&gt; AIC: NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 2</span>
<span class="no">colon.rm.adj</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rmeanglm.html">rmeanglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">time</span>, <span class="no">status</span>) ~ <span class="no">rx</span> + <span class="no">age</span> + <span class="no">node4</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">2500</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">colon.rm.adj</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; rmeanglm(formula = Surv(time, status) ~ rx + age + node4, time = 2500, </span>
<span class="co">#&gt;     data = colon)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -2035.7   -788.5    443.2    647.6   1385.7  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept) 2067.576    151.579  13.640  &lt; 2e-16 ***</span>
<span class="co">#&gt; rxLev          3.421     67.516   0.051  0.95958    </span>
<span class="co">#&gt; rxLev+5FU    185.349     67.365   2.751  0.00593 ** </span>
<span class="co">#&gt; age           -3.735      2.391  -1.562  0.11824    </span>
<span class="co">#&gt; node4       -644.960     64.854  -9.945  &lt; 2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 734414066  on 928  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 650039827  on 924  degrees of freedom</span>
<span class="co">#&gt; AIC: NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></pre></body></html></div>
<p>The estimates don’t change (much) and the standard errors reduce by about 5%.</p>
</div>
<div id="monoclonal-gammopathy-data-competing-risks" class="section level1">
<h1 class="hasAnchor">
<a href="#monoclonal-gammopathy-data-competing-risks" class="anchor"></a>Monoclonal gammopathy data (Competing risks)</h1>
<p>Our next example involves the <code>mgus2</code> dataset, included in the package:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r">?<span class="no">mgus2</span>
<span class="co">#&gt; Help on topic 'mgus2' was found in the following packages:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Package               Library</span>
<span class="co">#&gt;   eventglm              C:/Users/micsac/Documents/R/R-4.0.2/library</span>
<span class="co">#&gt;   survival              C:/Users/micsac/Documents/R/R-4.0.2/library</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Using the first match ...</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">mgus2</span>)
<span class="co">#&gt;   id age sex dxyr  hgb creat mspike ptime pstat futime death etime event</span>
<span class="co">#&gt; 1  1  88   F 1981 13.1   1.3    0.5    30     0     30     1    30 death</span>
<span class="co">#&gt; 2  2  78   F 1968 11.5   1.2    2.0    25     0     25     1    25 death</span>
<span class="co">#&gt; 3  3  94   M 1980 10.5   1.5    2.6    46     0     46     1    46 death</span>
<span class="co">#&gt; 4  4  68   M 1977 15.2   1.2    1.2    92     0     92     1    92 death</span>
<span class="co">#&gt; 5  5  90   F 1973 10.7   0.8    1.0     8     0      8     1     8 death</span>
<span class="co">#&gt; 6  6  90   M 1990 12.9   1.0    0.5     4     0      4     1     4 death</span></pre></body></html></div>
<p>This dataset has a number of covariates, and the time until progression to plasma cell malignancy (PCM), or death. Here the event PCM is of primary interest, with death being a competing event. The data are described and analyzed in the survival vignette (section 2.3.2):</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">crfit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">etime</span>, <span class="no">event</span>) ~ <span class="no">sex</span>, <span class="kw pkg">eventglm</span><span class="kw ns">::</span><span class="no"><a href="../reference/mgus2.html">mgus2</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">crfit</span>, <span class="kw">times</span> <span class="kw">=</span> <span class="fl">120</span>)
<span class="co">#&gt; Call: survfit(formula = Surv(etime, event) ~ sex, data = eventglm::mgus2)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  time n.risk n.event P((s0)) P(pcm) P(death)</span>
<span class="co">#&gt;   120    214     331   0.446 0.0739    0.480</span>
<span class="co">#&gt;   120    210     450   0.370 0.0553    0.575</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">crfit</span>, <span class="kw">rmean</span> <span class="kw">=</span> <span class="fl">120</span>)
<span class="co">#&gt; Call: survfit(formula = Surv(etime, event) ~ sex, data = eventglm::mgus2)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                n nevent    rmean*</span>
<span class="co">#&gt; sex=F, (s0)  631      0 82.983485</span>
<span class="co">#&gt; sex=M, (s0)  753      0 74.808346</span>
<span class="co">#&gt; sex=F, pcm   631     59  4.794595</span>
<span class="co">#&gt; sex=M, pcm   753     56  3.501305</span>
<span class="co">#&gt; sex=F, death 631    370 32.221921</span>
<span class="co">#&gt; sex=M, death 753    490 41.690349</span>
<span class="co">#&gt;    *mean time in state, restricted (max time = 120 )</span>

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">crfit</span>, <span class="kw">col</span><span class="kw">=</span><span class="fl">1</span>:<span class="fl">2</span>,  <span class="kw">noplot</span><span class="kw">=</span><span class="st">""</span>,
     <span class="kw">lty</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span>), <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">xscale</span><span class="kw">=</span><span class="fl">12</span>,
     <span class="kw">xlab</span><span class="kw">=</span><span class="st">"Years post diagnosis"</span>, <span class="kw">ylab</span><span class="kw">=</span><span class="st">"P(state)"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="fl">240</span>, <span class="fl">.65</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Female, death"</span>, <span class="st">"Male, death"</span>, <span class="st">"malignancy"</span>, <span class="st">"(s0)"</span>),
       <span class="kw">lty</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>), <span class="kw">col</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span>), <span class="kw">bty</span><span class="kw">=</span><span class="st">'n'</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">v</span> <span class="kw">=</span> <span class="fl">120</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>We can get similar estimates for the cumulative incidence of pcm at 10 years and the expected lifetime lost due to pcm up to 10 years with similar commands as above. Note the <code>cause</code> option to specify the cause of interest.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">mgfitci</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">etime</span>, <span class="no">event</span>) ~ <span class="no">sex</span>, <span class="kw">cause</span> <span class="kw">=</span> <span class="st">"pcm"</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">120</span>,
                   <span class="kw">data</span> <span class="kw">=</span> <span class="no">mgus2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mgfitci</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; cumincglm(formula = Surv(etime, event) ~ sex, time = 120, cause = "pcm", </span>
<span class="co">#&gt;     data = mgus2)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;      Min        1Q    Median        3Q       Max  </span>
<span class="co">#&gt; -0.08163  -0.07447  -0.06306  -0.05536   1.23923  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)  0.07383    0.01086   6.800 1.04e-11 ***</span>
<span class="co">#&gt; sexM        -0.01857    0.01384  -1.342     0.18    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 88.507  on 1383  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 88.388  on 1382  degrees of freedom</span>
<span class="co">#&gt; AIC: NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 2</span>

<span class="no">mgfitrmean</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rmeanglm.html">rmeanglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">etime</span>, <span class="no">event</span>) ~ <span class="no">sex</span>, <span class="kw">cause</span> <span class="kw">=</span> <span class="st">"pcm"</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">120</span>,
                       <span class="kw">data</span> <span class="kw">=</span> <span class="no">mgus2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mgfitrmean</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; rmeanglm(formula = Surv(etime, event) ~ sex, time = 120, cause = "pcm", </span>
<span class="co">#&gt;     data = mgus2)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt;  -4.971   -4.863   -3.678   -3.508  113.292  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)   4.7926     0.7883   6.080  1.2e-09 ***</span>
<span class="co">#&gt; sexM         -1.2929     0.9902  -1.306    0.192    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 450225  on 1383  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 449652  on 1382  degrees of freedom</span>
<span class="co">#&gt; AIC: NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></pre></body></html></div>
<p>Sex may be an important predictor of time to pcm, what about the other variables?</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">mgfitci2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">etime</span>, <span class="no">event</span>) ~ <span class="no">sex</span> + <span class="no">age</span> + <span class="no">hgb</span>, <span class="kw">cause</span> <span class="kw">=</span> <span class="st">"pcm"</span>,
                      <span class="kw">time</span> <span class="kw">=</span> <span class="fl">120</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">mgus2</span>)
<span class="no">mgfitrmean2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rmeanglm.html">rmeanglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">etime</span>, <span class="no">event</span>) ~ <span class="no">sex</span> + <span class="no">age</span> + <span class="no">hgb</span>, <span class="kw">cause</span> <span class="kw">=</span> <span class="st">"pcm"</span>,
                      <span class="kw">time</span> <span class="kw">=</span> <span class="fl">120</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">mgus2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mgfitrmean2</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; rmeanglm(formula = Surv(etime, event) ~ sex + age + hgb, time = 120, </span>
<span class="co">#&gt;     cause = "pcm", data = mgus2)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt;  -7.081   -4.795   -4.034   -3.278  112.970  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)</span>
<span class="co">#&gt; (Intercept)  3.98253    3.87360   1.028    0.304</span>
<span class="co">#&gt; sexM        -0.98992    0.99168  -0.998    0.318</span>
<span class="co">#&gt; age          0.04466    0.02941   1.518    0.129</span>
<span class="co">#&gt; hgb         -0.18754    0.25091  -0.747    0.455</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for quasi family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 448531  on 1370  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 447319  on 1367  degrees of freedom</span>
<span class="co">#&gt;   (13 observations deleted due to missingness)</span>
<span class="co">#&gt; AIC: NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></pre></body></html></div>
<p>The objects returned by <code>cumincglm</code> and <code>rmeanglm</code> inherit from <code>glm</code>, so many methods are available. First, the <code>vcov</code> function has several options for calculation of the estimated variance of the estimated regression parameters. By default, the <code>robust</code> variance estimates are used, based on the Huber-White estimator. Other options are naive, and corrected, which are the corrected estimators suggested by <span class="citation">Overgaard et al. (2017)</span> which are based on a second order Von-Mises expansion. We can also use the bootstrap. This recalculated the pseudo-observations every time, but it is still pretty fast because of the C code. Let’s compare:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">nboot</span> <span class="kw">&lt;-</span> <span class="fl">100</span> <span class="co"># use a bigger number for real</span>
<span class="no">bootests</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">NA</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="no">nboot</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">4</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">nboot</span>) {
  <span class="no">mgus.b</span> <span class="kw">&lt;-</span> <span class="no">mgus2</span>[<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">mgus2</span>), <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>), ]
  <span class="no">mgfitrmean.b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rmeanglm.html">rmeanglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">etime</span>, <span class="no">event</span>) ~ <span class="no">sex</span> + <span class="no">age</span> + <span class="no">hgb</span>, <span class="kw">cause</span> <span class="kw">=</span> <span class="st">"pcm"</span>,
                      <span class="kw">time</span> <span class="kw">=</span> <span class="fl">120</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">mgus.b</span>)
  <span class="no">bootests</span>[<span class="no">i</span>,] <span class="kw">&lt;-</span> <span class="no">mgfitrmean.b</span>$<span class="no">coefficients</span>
}

<span class="no">se.boot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">bootests</span>)))
<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">se.boot</span> <span class="kw">=</span> <span class="no">se.boot</span>,
      <span class="kw">se.robust</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span>(<span class="no">mgfitrmean2</span>))),
      <span class="co">#se.corrected = sqrt(diag(vcov(mgfitrmean2, type = "corrected"))), </span>
      <span class="kw">se.naive</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span>(<span class="no">mgfitrmean2</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"naive"</span>)))), <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">se.boot</th>
<th align="right">se.robust</th>
<th align="right">se.naive</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">3.967</td>
<td align="right">3.874</td>
<td align="right">4.749</td>
</tr>
<tr class="even">
<td align="left">sexM</td>
<td align="right">1.069</td>
<td align="right">0.992</td>
<td align="right">1.012</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="right">0.029</td>
<td align="right">0.029</td>
<td align="right">0.041</td>
</tr>
<tr class="even">
<td align="left">hgb</td>
<td align="right">0.263</td>
<td align="right">0.251</td>
<td align="right">0.253</td>
</tr>
</tbody>
</table>
<p>The corrected estimator fails pretty often, because it doesn’t handle ties, and the benefits are negligible, and thus may be removed from the package in the future.</p>
<p>Residuals also work, using the scaling factor suggested by <span class="citation">Perme and Andersen (2008)</span>, as do predictions. Predicted restricted means give a possible method to predict individual event times, while the predicted cumulative incidence should be probabilities. Note that with the identity link, the predicted cumulative incidence is not guaranteed to be between 0 and 1.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">mgfitrmean2</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">mgus2</span>),
     <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Predicted lifetime lost due to PCM"</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">""</span>)</pre></body></html></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<div class="sourceCode" id="cb17"><html><body><pre class="r">
<span class="no">mgus2</span>$<span class="no">prob.pcm10</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">mgfitci2</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">mgus2</span>)
<span class="no">mgus2</span>$<span class="no">pseudo.ci</span> <span class="kw">&lt;-</span> <span class="no">mgfitci</span>$<span class="no">y</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mgus2</span>$<span class="no">prob.pcm10</span>)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">#&gt; 0.05169 0.05559 0.05695 0.06348 0.07297 0.07522      13</span>
<span class="no">cutps</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">mgus2</span>$<span class="no">prob.pcm10</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">.1</span>, <span class="fl">.9</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">.1</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">mgus2</span>$<span class="no">prob.cut</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">mgus2</span>$<span class="no">prob.pcm10</span>,
                      <span class="no">cutps</span>)

<span class="no">pred.p</span> <span class="kw">&lt;-</span> <span class="no">cutps</span>[-<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">cutps</span>)] + <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="no">cutps</span>)
<span class="no">obs.p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/by.html">by</a></span>(<span class="no">mgus2</span>$<span class="no">pseudo.ci</span>, <span class="no">mgus2</span>$<span class="no">prob.cut</span>, <span class="no">mean</span>))

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">obs.p</span> ~ <span class="no">pred.p</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"predicted"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"observed"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="fl">0</span>, <span class="fl">1</span>)</pre></body></html></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-16-2.png" width="672"></p>
</div>
<div id="censoring-assumptions" class="section level1">
<h1 class="hasAnchor">
<a href="#censoring-assumptions" class="anchor"></a>Censoring assumptions</h1>
<p>By default, we assume that time to censoring is independent of the time to the event, and of all covariates in the model. This is more restrictive than parametric survival models, or Cox regression, which only assumes that censoring time is conditionally independent of event time given the covariates in the model. We provide several options to relax that assumption using the <code>model.censoring</code> and <code>formula.censoring</code> options. The first is to compute stratified pseudo observations, which assumes that the censoring is independent given a set of categorical covariates:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">colon.ci.cen1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">time</span>, <span class="no">status</span>) ~ <span class="no">rx</span> + <span class="no">age</span> + <span class="no">node4</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">2500</span>,
                           <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon</span>, <span class="kw">model.censoring</span> <span class="kw">=</span> <span class="st">"stratified"</span>,
                           <span class="kw">formula.censoring</span> <span class="kw">=</span> ~ <span class="no">rx</span>)</pre></body></html></div>
<p>Next, we can assume that the time to censoring follows a Cox model given a set of covariates. By default, the same covariate formula (right hand side) as the main model is used, but any formula can be specified. We can also use Aalens additive hazards model instead of a Cox model for the censoring distribution. Then inverse probability of censoring weighted pseudo observations are used <span class="citation">(Overgaard, Parner, and Pedersen 2019)</span>. According to our simulation study, the stratified option works quite well even when the censoring model is misspecified, and the Aalen additive model tends to work better than the Cox model.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">colon.ci.cen2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">time</span>, <span class="no">status</span>) ~ <span class="no">rx</span> + <span class="no">age</span> + <span class="no">node4</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">2500</span>,
                           <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon</span>, <span class="kw">model.censoring</span> <span class="kw">=</span> <span class="st">"coxph"</span>,
                           <span class="kw">formula.censoring</span> <span class="kw">=</span> ~ <span class="no">rx</span> + <span class="no">age</span> + <span class="no">node4</span>)
<span class="no">colon.ci.cen3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">time</span>, <span class="no">status</span>) ~ <span class="no">rx</span> + <span class="no">age</span> + <span class="no">node4</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">2500</span>,
                           <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon</span>, <span class="kw">model.censoring</span> <span class="kw">=</span> <span class="st">"aareg"</span>,
                           <span class="kw">formula.censoring</span> <span class="kw">=</span> ~ <span class="no">rx</span> + <span class="no">age</span> + <span class="no">node4</span>)

<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="st">"indep"</span> <span class="kw">=</span> <span class="no">colon.ci.adj</span>$<span class="no">coefficients</span>,
      <span class="st">"strat"</span> <span class="kw">=</span> <span class="no">colon.ci.cen1</span>$<span class="no">coefficients</span>,
      <span class="st">"coxipcw"</span> <span class="kw">=</span> <span class="no">colon.ci.cen2</span>$<span class="no">coefficients</span>,
      <span class="st">"aalenipcw"</span> <span class="kw">=</span> <span class="no">colon.ci.cen3</span>$<span class="no">coefficients</span>), <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">indep</th>
<th align="right">strat</th>
<th align="right">coxipcw</th>
<th align="right">aalenipcw</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.318</td>
<td align="right">0.314</td>
<td align="right">0.297</td>
<td align="right">0.317</td>
</tr>
<tr class="even">
<td align="left">rxLev</td>
<td align="right">-0.034</td>
<td align="right">-0.035</td>
<td align="right">-0.031</td>
<td align="right">-0.036</td>
</tr>
<tr class="odd">
<td align="left">rxLev+5FU</td>
<td align="right">-0.127</td>
<td align="right">-0.128</td>
<td align="right">-0.110</td>
<td align="right">-0.129</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.002</td>
<td align="right">0.002</td>
<td align="right">0.003</td>
<td align="right">0.002</td>
</tr>
<tr class="odd">
<td align="left">node4</td>
<td align="right">0.332</td>
<td align="right">0.334</td>
<td align="right">0.330</td>
<td align="right">0.335</td>
</tr>
</tbody>
</table>
</div>
<div id="relative-survivalnet-survival" class="section level1">
<h1 class="hasAnchor">
<a href="#relative-survivalnet-survival" class="anchor"></a>Relative survival/net survival</h1>
<p>Following Professor Paul Lambert’s example here: <a href="https://pclambert.net/software/stpp/using_stpp/" class="uri">https://pclambert.net/software/stpp/using_stpp/</a> , let’s load the datasets:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">data.table</span>)

<span class="co"># from https://pclambert.net/data/colon.dta</span>
<span class="no">colon2</span> <span class="kw">&lt;-</span> <span class="kw pkg">rio</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"colon.dta"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"eventglm"</span>))
<span class="no">colon2</span>$<span class="no">surv_mm_trunc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span>(<span class="no">colon2</span>$<span class="no">surv_mm</span> <span class="kw">&gt;</span> <span class="fl">120.5</span>, <span class="fl">120.5</span>, <span class="no">colon2</span>$<span class="no">surv_mm</span>)

<span class="no">colon2</span>$<span class="no">death</span> <span class="kw">&lt;-</span> <span class="no">colon2</span>$<span class="no">status</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>)
<span class="no">colon2</span>$<span class="no">death</span>[<span class="no">colon2</span>$<span class="no">surv_mm</span> <span class="kw">&gt;</span> <span class="no">colon2</span>$<span class="no">surv_mm_trunc</span>] <span class="kw">&lt;-</span> <span class="fl">0</span>

<span class="co"># from https://pclambert.net/data/popmort.dta</span>
<span class="no">lifetab</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span>(<span class="kw pkg">rio</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"popmort.dta"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"eventglm"</span>)))</pre></body></html></div>
<p>Now we will estimate the marginal relative survival using the approach described in <span class="citation">Pavlič and Pohar Perme (2019)</span>, which is based on the estimator:</p>
<p><span class="math display">\[
RS(t) = n^{-1}\sum_{i = 1}^n\frac{PO_i(t)}{S_{P}(t | D)}, 
\]</span></p>
<p>where <span class="math inline">\(S_{P}(t | D)\)</span> is the survival probability based on the life tables for the demographics <span class="math inline">\(D\)</span> of patient <span class="math inline">\(i\)</span>, and <span class="math inline">\(PO_i(t)\)</span> are the pseudo observations for time <span class="math inline">\(t\)</span>. We get the survival probability by merging with the life table estimates, and the pseudo observations from our package. The <code>prob</code> from the life tables is the probability of surviving one year, so to get the probability of surviving 5 and 10 years, we need to calculate the cumulative product estimates.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r">
<span class="no">lifetab</span>[, <span class="no">prob.5</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span>(<span class="no">lifetab</span>[<span class="no">`_age`</span> <span class="kw">%in%</span> <span class="no">.BY</span><span class="kw">[[</span><span class="st">"_age"</span>]]:(<span class="no">.BY</span><span class="kw">[[</span><span class="st">"_age"</span>]]+<span class="fl">4</span>) <span class="kw">&amp;</span>
                              <span class="no">`_year`</span> <span class="kw">%in%</span> <span class="no">.BY</span><span class="kw">[[</span><span class="st">"_year"</span>]]:(<span class="no">.BY</span><span class="kw">[[</span><span class="st">"_year"</span>]]+<span class="fl">4</span>) <span class="kw">&amp;</span>
                                <span class="no">`_year`</span> <span class="kw">==</span> <span class="no">.BY</span><span class="kw">[[</span><span class="st">"_year"</span>]] - <span class="no">.BY</span><span class="kw">[[</span><span class="st">"_age"</span>]] + <span class="no">`_age`</span> <span class="kw">&amp;</span>
                              <span class="no">sex</span> <span class="kw">==</span> <span class="no">.BY</span><span class="kw">[[</span><span class="st">"sex"</span>]] ]$<span class="no">prob</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
        <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sex"</span>, <span class="st">"_year"</span>, <span class="st">"_age"</span>)]

<span class="no">lifetab</span>[, <span class="no">prob.10</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span>(<span class="no">lifetab</span>[<span class="no">`_age`</span> <span class="kw">%in%</span> <span class="no">.BY</span><span class="kw">[[</span><span class="st">"_age"</span>]]:(<span class="no">.BY</span><span class="kw">[[</span><span class="st">"_age"</span>]]+<span class="fl">9</span>) <span class="kw">&amp;</span>
                              <span class="no">`_year`</span> <span class="kw">%in%</span> <span class="no">.BY</span><span class="kw">[[</span><span class="st">"_year"</span>]]:(<span class="no">.BY</span><span class="kw">[[</span><span class="st">"_year"</span>]]+<span class="fl">9</span>) <span class="kw">&amp;</span>
                                <span class="no">`_year`</span> <span class="kw">==</span> <span class="no">.BY</span><span class="kw">[[</span><span class="st">"_year"</span>]] - <span class="no">.BY</span><span class="kw">[[</span><span class="st">"_age"</span>]] + <span class="no">`_age`</span> <span class="kw">&amp;</span>
                              <span class="no">sex</span> <span class="kw">==</span> <span class="no">.BY</span><span class="kw">[[</span><span class="st">"sex"</span>]] ]$<span class="no">prob</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
        <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sex"</span>, <span class="st">"_year"</span>, <span class="st">"_age"</span>)]


<span class="no">colon2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="no">colon2</span>, <span class="no">lifetab</span>,
                <span class="kw">by.x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sex"</span>, <span class="st">"yydx"</span>, <span class="st">"age"</span>),
                <span class="kw">by.y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sex"</span>,  <span class="st">"_year"</span>, <span class="st">"_age"</span>), <span class="kw">all.x</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">all.y</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">fit1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="kw pkg">survival</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">surv_mm_trunc</span>, <span class="no">death</span>) ~ <span class="fl">1</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon2</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">1</span> * <span class="fl">12</span>)
<span class="no">fit5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="kw pkg">survival</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">surv_mm_trunc</span>, <span class="no">death</span>) ~ <span class="fl">1</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon2</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">5</span> * <span class="fl">12</span>)
<span class="no">fit10</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="kw pkg">survival</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">surv_mm_trunc</span>, <span class="no">death</span>) ~ <span class="fl">1</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon2</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">10</span> * <span class="fl">12</span>)

<span class="no">colon2</span>$<span class="no">po_1</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - <span class="no">fit1</span>$<span class="no">y</span>
<span class="no">colon2</span>$<span class="no">po_5</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - <span class="no">fit5</span>$<span class="no">y</span>
<span class="no">colon2</span>$<span class="no">po_10</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - <span class="no">fit10</span>$<span class="no">y</span>

<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">time</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>),
                   <span class="kw">relsurv.pseudo</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">colon2</span>,
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">po_1</span> / <span class="no">prob</span>),
                                    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">po_5</span> / <span class="no">prob.5</span>),
                                    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">po_10</span> / <span class="no">prob.10</span>)),
                                  ),
                   <span class="kw">relsurv.pohar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.682</span>, <span class="fl">0.479</span>, <span class="fl">0.441</span>)), <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">time</th>
<th align="right">relsurv.pseudo</th>
<th align="right">relsurv.pohar</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.677</td>
<td align="right">0.682</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">0.477</td>
<td align="right">0.479</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">0.411</td>
<td align="right">0.441</td>
</tr>
</tbody>
</table>
<p>They are pretty close to those computed using the Pohar Perme estimator reported by Prof Lambert.</p>
</div>
<div id="case-cohort-sampling" class="section level1">
<h1 class="hasAnchor">
<a href="#case-cohort-sampling" class="anchor"></a>Case cohort sampling</h1>
<p><span class="citation">Parner, Andersen, and Overgaard (2020)</span> describe how to fit regression models with pseudo-observations that account for case-cohort sampling. The basic idea is weighted estimating equations, which we can implement easily with the <code>weights</code> argument that gets passed to <code>glm.fit</code>. First let’s create a case-cohort sample of the <code>colon2</code> dataset by sampling the cancer deaths (<code>status == 1</code>) with probability 0.8, and a random subcohort with probability 0.1.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">colon2</span>$<span class="no">status2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span>(<span class="no">colon2</span>$<span class="no">status</span> <span class="kw">==</span> <span class="fl">4</span>, <span class="fl">0</span>, <span class="no">colon2</span>$<span class="no">status</span>),
                         <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"censored"</span>, <span class="st">"cancer death"</span>, <span class="st">"other death"</span>))
<span class="no">subc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">colon2</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="fl">.2</span>)
<span class="no">samp.ind</span> <span class="kw">&lt;-</span> <span class="no">subc</span> + (<span class="fl">1</span> - <span class="no">subc</span>) * (<span class="no">colon2</span>$<span class="no">status</span> <span class="kw">==</span> <span class="fl">1</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">colon2</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="fl">.9</span>)
<span class="no">colon.cc</span> <span class="kw">&lt;-</span> <span class="no">colon2</span>[<span class="fu"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span>(<span class="no">samp.ind</span>), ]
<span class="no">colon.cc</span>$<span class="no">samp.wt</span> <span class="kw">&lt;-</span> <span class="fl">1</span> / <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span>(<span class="no">colon.cc</span>$<span class="no">status</span> <span class="kw">==</span> <span class="fl">1</span>, <span class="fl">.2</span> + <span class="fl">.8</span> * <span class="fl">.9</span>, <span class="fl">.2</span>)</pre></body></html></div>
<p>Now, the weighted regression model should give similar results as the unweighted one in the full sample:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">cfit.cc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">surv_mm</span>, <span class="no">status2</span>) ~ <span class="no">age</span> + <span class="no">sex</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">subsite</span>),
                     <span class="kw">cause</span> <span class="kw">=</span> <span class="st">"cancer death"</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">5</span> * <span class="fl">12</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon.cc</span>,
                     <span class="kw">weights</span> <span class="kw">=</span> <span class="no">samp.wt</span>)
<span class="no">cfit.full</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cumincglm.html">cumincglm</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">surv_mm</span>, <span class="no">status2</span>) ~ <span class="no">age</span> + <span class="no">sex</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">subsite</span>),
                     <span class="kw">cause</span> <span class="kw">=</span> <span class="st">"cancer death"</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">5</span> * <span class="fl">12</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">colon2</span>)
<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">casecohort</span> <span class="kw">=</span> <span class="no">cfit.cc</span>$<span class="no">coefficients</span>,
      <span class="kw">fullsamp</span> <span class="kw">=</span> <span class="no">cfit.full</span>$<span class="no">coefficients</span>), <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">casecohort</th>
<th align="right">fullsamp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.27</td>
<td align="right">0.21</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">factor(subsite)2</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
</tr>
<tr class="odd">
<td align="left">factor(subsite)3</td>
<td align="right">0.03</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">factor(subsite)4</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-overgaard2019pseudo">
<p>Overgaard, Morten, Erik Thorlund Parner, and Jan Pedersen. 2019. “Pseudo-Observations Under Covariate-Dependent Censoring.” <em>Journal of Statistical Planning and Inference</em> 202: 112–22.</p>
</div>
<div id="ref-overgaard2017asymptotic">
<p>Overgaard, Morten, Erik Thorlund Parner, Jan Pedersen, and others. 2017. “Asymptotic Theory of Generalized Estimating Equations Based on Jack-Knife Pseudo-Observations.” <em>The Annals of Statistics</em> 45 (5): 1988–2015.</p>
</div>
<div id="ref-parner2020cumulative">
<p>Parner, Erik T, Per K Andersen, and Morten Overgaard. 2020. “Cumulative Risk Regression in Case–Cohort Studies Using Pseudo-Observations.” <em>Lifetime Data Analysis</em>, 1–20.</p>
</div>
<div id="ref-pavlivc2019using">
<p>Pavlič, Klemen, and Maja Pohar Perme. 2019. “Using Pseudo-Observations for Estimation in Relative Survival.” <em>Biostatistics</em> 20 (3): 384–99.</p>
</div>
<div id="ref-perme2008checking">
<p>Perme, Maja Pohar, and Per Kragh Andersen. 2008. “Checking Hazard Regression Models Using Pseudo-Observations.” <em>Statistics in Medicine</em> 27 (25): 5309–28.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael C Sachs, Erin E Gabriel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
